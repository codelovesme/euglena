image: nikolaik/python-nodejs:python3.6-nodejs16-stretch

stages:
    - publish

publish:
    stage: publish
    script:
        - npm i -g lerna
        - yarn
        - yarn compile
        - echo "@euglena:registry=http://codeloves.me:2800/api/v4/projects/${CI_PROJECT_ID}/packages/npm/">>.yarnrc
        - echo "//codeloves.me:2800/api/v4/packages/npm/:_authToken=${CI_JOB_TOKEN}">>.yarnrc
        - echo "//codeloves.me:2800/api/v4/projects/${CI_PROJECT_ID}/packages/npm/:_authToken=${CI_JOB_TOKEN}">>.yarnrc
        - lerna publish from-package --registry
          http://codeloves.me:2800/api/v4/projects/${CI_PROJECT_ID}/packages/npm/:_authToken=${CI_JOB_TOKEN} -y
    # only:
    #     - tags
